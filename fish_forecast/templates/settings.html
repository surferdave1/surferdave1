{% extends "layout.html" %}

{% block title %}
    Forecast Settings
{% endblock %}

{% block main %}
<body>
    <h1>Settings</h1>
    <p>Adjust your forecast settings Here</p>
<!DOCTYPE html>
<html>
<head>
  <title>Fishing Location Input</title>
</head>
<body>
  <h2>Enter Your Location</h2>
  <form id="locationForm">
    <label for="location">City, State:</label>
    <input type="text" id="location" name="location" required>
    
    <label for="date">Date:</label>
    <input type="date" id="date" name="date" required>

    <button type="submit">Get Coordinates</button>
  </form>

  <p id="output"></p>
<!-- JavaScript to handle form submission and fetch coordinates -->
<!-- Using OpenCage Geocoding API -->
<!-- code below created by co-pilot -->
  <script>
  document.getElementById("locationForm").addEventListener("submit", function(e) {
    e.preventDefault();
    const location = document.getElementById("location").value;

    const apiKey = "1a01d4aa2eec4f97a8a60af24e3802ce";
    const url = `https://api.opencagedata.com/geocode/v1/json?q=${encodeURIComponent(location)}&key=${apiKey}&countrycode=us&limit=1`;

    fetch(url)
      .then(response => response.json())
      .then(data => {
        if (data.results.length > 0) {
          const lat = data.results[0].geometry.lat;
          const lng = data.results[0].geometry.lng;
          const date = document.getElementById("date").value;

          document.getElementById("output").innerText = `Latitude: ${lat}, Longitude: ${lng}`;

          // Send to Flask backend
          fetch("/save_settings", {
            method: "POST",
            headers: {
              "Content-Type": "application/json"
            },
            body: JSON.stringify({ lat: lat, lng: lng, date: date })
          })
          .then(response => response.json())
          .then(data => {
            console.log("Coordinates saved:", data);
          })
          .catch(error => {
            console.error("Error sending coordinates:", error);
          });

        } else {
          document.getElementById("output").innerText = "Location not found.";
        }
      })
      .catch(error => {
        console.error("Error fetching coordinates:", error);
        document.getElementById("output").innerText = "Error fetching coordinates.";
      });
  });
</script>
  
</body>
</html>
    
</body>
{% endblock %}